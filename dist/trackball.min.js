/*
Trackball.js v1.2.0 10/4/2024
https://raw.org/article/trackball-rotation-using-quaternions/

Copyright (c) 2024, Robert Eisele (https://raw.org/)
Licensed under the MIT license.
*/
'use strict';(function(u){function n(c){function e(b){0!==f&&p();var q=k.getBoundingClientRect();b=a.g(b.clientX,b.clientY,q);l=h=performance.now();a.drag={startVector:b,box:q};requestAnimationFrame(a._doDraw)}function d(b){null!==a.drag&&(b=Quaternion.fromBetweenVectors(a.drag.startVector,a.g(b.clientX,b.clientY,a.drag.box)),a.q=b.mul(a.p),requestAnimationFrame(a._doDraw))}function g(b){if(null!==a.drag){l=h;h=performance.now();b=Quaternion.fromBetweenVectors(a.drag.startVector,a.g(b.clientX,b.clientY,
a.drag.box));a.p=a.q=b.mul(a.p);a.drag=null;if(a.opts.smooth&&(f=Math.min(.2,Math.abs(2*Math.acos(b.w)/Math.max((h-l)/50,1))),0<f)){r=[b.x,b.y,b.z];m=0;a.slideID=requestAnimationFrame(t);return}requestAnimationFrame(a._doDraw)}}function t(){m+=f;f*=.93;a.q=Quaternion.fromAxisAngle(r,m).mul(a.p);a._doDraw();.001>f?p():a.slideID=requestAnimationFrame(t)}function p(){cancelAnimationFrame(a.slideID);a.p=a.q;a.slideID=null;f=0}var a=this,l=0,h=0,f=0,r=null,m=0;c||={};c.nodeType&&(c={scene:c});"string"===
typeof c.scene&&(c.scene=document.querySelector(c.scene));c.onDraw||(c.onDraw=function(){});a.opts=c;a.p=a.q=c.q||Quaternion.ONE;var k=c.scene;a._doDraw=function(){c.onDraw.call(a,a.q)};k.addEventListener("mousedown",e,{passive:!0});document.addEventListener("mousemove",d,{passive:!0});document.addEventListener("mouseup",g,{passive:!0});k.addEventListener("touchstart",function(b){b.preventDefault();1===b.touches.length&&e(b.touches[0])},{passive:!1});document.addEventListener("touchmove",function(b){1===
b.changedTouches.length&&d(b.changedTouches[0])},{passive:!0});document.addEventListener("touchend",function(b){1===b.changedTouches.length&&g(b.changedTouches[0])},{passive:!0});requestAnimationFrame(a._doDraw)}n.prototype={p:null,q:null,opts:null,slideID:null,drag:null,g:function(c,e,d){var g=Math.max(d.width,d.height)-1;c="x"===this.opts.limitAxis?0:(2*(c-d.x)-d.width-1)/g;e="y"===this.opts.limitAxis?0:(2*(e-d.y)-d.height-1)/g;d=c*c+e*e;return 1>=2*d?[c,e,Math.sqrt(1-d)]:[c,e,.5/Math.sqrt(d)]},
rotate:function(c){this.drag||this.slideID||(this.q=this.p=this.p.mul(c),requestAnimationFrame(this._doDraw))}};u.Trackball=n})(this);
