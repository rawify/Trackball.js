/*
Trackball.js v1.2.4 10/28/2024
https://raw.org/article/trackball-rotation-using-quaternions/

Copyright (c) 2024, Robert Eisele (https://raw.org/)
Licensed under the MIT license.
*/
'use strict';(function(u){function e(c){function f(b){0!==g&&p();var q=l.getBoundingClientRect();b=a.g(b.clientX,b.clientY,q);m=k=performance.now();a.drag={startVector:b,box:q};requestAnimationFrame(a._doDraw)}function d(b){null!==a.drag&&(b=Quaternion.fromVectors(a.drag.startVector,a.g(b.clientX,b.clientY,a.drag.box)),a.q=b.mul(a.p),requestAnimationFrame(a._doDraw))}function h(b){if(null!==a.drag){m=k;k=performance.now();b=Quaternion.fromVectors(a.drag.startVector,a.g(b.clientX,b.clientY,a.drag.box));
a.p=a.q=b.mul(a.p);a.drag=null;if(a.opts.smooth&&(g=Math.min(.2,Math.abs(2*Math.acos(b.w)/Math.max((k-m)/50,1))),0<g)){r=[b.x,b.y,b.z];n=0;a.slideID=requestAnimationFrame(t);return}requestAnimationFrame(a._doDraw)}}function t(){n+=g;g*=.93;a.q=Quaternion.fromAxisAngle(r,n).mul(a.p);a._doDraw();.001>g?p():a.slideID=requestAnimationFrame(t)}function p(){cancelAnimationFrame(a.slideID);a.p=a.q;a.slideID=null;g=0}var a=this,m=0,k=0,g=0,r=null,n=0;c||={};c.nodeType&&(c={scene:c});"string"===typeof c.scene&&
(c.scene=document.querySelector(c.scene));c.onDraw||(c.onDraw=function(){});a.opts=c;a.p=a.q=c.q||Quaternion.ONE;var l=c.scene;a._doDraw=function(){c.onDraw.call(a,a.q)};l.addEventListener("mousedown",f,{passive:!0});document.addEventListener("mousemove",d,{passive:!0});document.addEventListener("mouseup",h,{passive:!0});l.addEventListener("touchstart",function(b){b.preventDefault();1===b.touches.length&&f(b.touches[0])},{passive:!1});document.addEventListener("touchmove",function(b){1===b.changedTouches.length&&
d(b.changedTouches[0])},{passive:!0});document.addEventListener("touchend",function(b){1===b.changedTouches.length&&h(b.changedTouches[0])},{passive:!0});requestAnimationFrame(a._doDraw)}e.prototype={p:null,q:null,opts:null,slideID:null,drag:null,g:function(c,f,d){var h=Math.max(d.width,d.height)-1;c="x"===this.opts.limitAxis?0:(2*(c-d.x)-d.width-1)/h;f="y"===this.opts.limitAxis?0:(2*(f-d.y)-d.height-1)/h;d=c*c+f*f;return 1>=2*d?[c,f,Math.sqrt(1-d)]:[c,f,.5/Math.sqrt(d)]},rotate:function(c){this.drag||
this.slideID||(this.q=this.p=this.p.mul(c),requestAnimationFrame(this._doDraw))}};"function"===typeof define&&define.amd?define([],function(){return e}):"object"===typeof exports?(Object.defineProperty(e,"__esModule",{value:!0}),e["default"]=e,e.Trackball=e,module.exports=e):u.Trackball=e})(this);
